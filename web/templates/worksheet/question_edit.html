{% extends "base.html" %}

{% block title %}{% if question %}Edit Question{% else %}Add Question{% endif %}{% endblock %}

{% block content %}
<div class="form-container">
    <h1>{% if question %}‚úèÔ∏è Edit Question{% else %}‚ûï Add Question{% endif %}</h1>
    <h3>{{ subtopic.subtopic_name }}</h3>
    
    <form method="POST">
        <div class="form-group">
            <label for="question_text">Question Text <span style="color: red;">*</span></label>
            <textarea id="question_text" name="question_text" class="form-control" 
                      rows="4" required>{{ question.question_text if question else '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="answer">Answer (Optional)</label>
            <textarea id="answer" name="answer" class="form-control" 
                      rows="3" placeholder="Enter the answer or solution (optional for tutor reference)">{{ question.answer if question and question.answer else '' }}</textarea>
            <small style="color: #666;">This answer is for tutor reference only and won't appear on student worksheets</small>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="is_template" name="is_template" onchange="toggleTemplateMode()">
                This is a variable question template
            </label>
        </div>

        <div id="template_help" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
            <h5>üìù Variable Question Help</h5>
            <p>Use curly braces to create variables that will be randomly generated:</p>
            <ul>
                <li><code>{num1}</code> - Random number 1-100</li>
                <li><code>{num1:5-15}</code> - Random number between 5 and 15</li>
                <li><code>{num2:10-50}</code> - Another random number between 10 and 50</li>
            </ul>
            <p><strong>Example:</strong> What is {num1:1-20} + {num2:1-20}?</p>
            
            <div id="template_preview" style="margin-top: 15px;">
                <button type="button" onclick="previewTemplate()" class="btn btn-info">Preview Examples</button>
                <div id="preview_results"></div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="difficulty_level">Difficulty Level <span style="color: red;">*</span></label>
            <select id="difficulty_level" name="difficulty_level" class="form-control" required>
                <option value="">Select difficulty...</option>
                <option value="1" {% if question and question.difficulty_level == 1 %}selected{% endif %}>
                    üü¢ Easy (1-2 minutes)
                </option>
                <option value="2" {% if question and question.difficulty_level == 2 %}selected{% endif %}>
                    üü° Medium (3-5 minutes)
                </option>
                <option value="3" {% if question and question.difficulty_level == 3 %}selected{% endif %}>
                    üî¥ Hard (7-10 minutes)
                </option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="time_estimate">Time Estimate (minutes)</label>
            <input type="number" id="time_estimate" name="time_estimate" class="form-control"
                   min="1" max="20" value="{{ question.time_estimate_minutes if question else '' }}"
                   placeholder="Estimated completion time">
        </div>
        
        <div class="form-group">
            <label for="space_required">Space Required</label>
            <select id="space_required" name="space_required" class="form-control" required>
                <option value="none" {% if question and question.space_required == 'none' %}selected{% endif %}>
                    None (answer line only)
                </option>
                <option value="small" {% if question and question.space_required == 'small' %}selected{% endif %}>
                    Small (2-3 lines)
                </option>
                <option value="medium" {% if question and question.space_required == 'medium' %}selected{% endif %}>
                    Medium (5-6 lines)
                </option>
                <option value="large" {% if question and question.space_required == 'large' %}selected{% endif %}>
                    Large (10+ lines)
                </option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="question_type">Question Type (optional)</label>
            <input type="text" id="question_type" name="question_type" class="form-control"
                   placeholder="e.g., word problem, calculation, reasoning"
                   value="{{ question.question_type if question else '' }}">
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="{{ url_for('worksheet.question_bank', subtopic_id=subtopic.id) }}" class="btn">Cancel</a>
            <button type="submit" class="btn btn-success">
                {% if question %}üíæ Update Question{% else %}‚ûï Add Question{% endif %}
            </button>
        </div>
    </form>
</div>

<div class="nav-links">
    <a href="{{ url_for('worksheet.question_bank', subtopic_id=subtopic.id) }}">üìù Back to Question Bank</a>
    <a href="{{ url_for('topic.topic_detail', topic_id=subtopic.main_topic_id) }}">üìñ Back to {{ subtopic.topic_name }}</a>
    <a href="{{ url_for('main.dashboard') }}">üè† Dashboard</a>
</div>

<script>
function toggleTemplateMode() {
    const isTemplate = document.getElementById('is_template').checked;
    document.getElementById('template_help').style.display = isTemplate ? 'block' : 'none';
    
    if (isTemplate) {
        // Update placeholder
        document.getElementById('question_text').placeholder = 'e.g., What is {num1:1-20} + {num2:1-20}?';
    } else {
        document.getElementById('question_text').placeholder = 'Enter your question text...';
    }
}

function previewTemplate() {
    const questionText = document.getElementById('question_text').value;
    const previewDiv = document.getElementById('preview_results');
    
    // Simple client-side preview
    let previews = '<h6>Example Questions:</h6><ul>';
    
    for (let i = 0; i < 3; i++) {
        let preview = questionText;
        // Find all variables
        const matches = preview.match(/\{(\w+)(?::(\d+)-(\d+))?\}/g);
        
        if (matches) {
            matches.forEach(match => {
                const parts = match.match(/\{(\w+)(?::(\d+)-(\d+))?\}/);
                const min = parseInt(parts[2]) || 1;
                const max = parseInt(parts[3]) || 100;
                const value = Math.floor(Math.random() * (max - min + 1)) + min;
                preview = preview.replace(match, value);
            });
        }
        
        previews += `<li>${preview}</li>`;
    }
    previews += '</ul>';
    
    previewDiv.innerHTML = previews;
}
</script>

{% endblock %}